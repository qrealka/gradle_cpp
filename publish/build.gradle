/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'dloginov' at '11/11/15 4:16 PM' with Gradle 2.8
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/2.8/userguide/tutorial_java_projects.html
 */

apply plugin: 'maven'

buildscript {
    repositories {
        ivy {
            // URL can refer to a local directory
            url repositoryUrl
        }
    }
}


task ConfigParse {
	description  = 'try to parse binary_delivery.config'

    def cfg = new XmlParser().parse('uploads/packages.config');
    cfg.package.each {
        project(':' + it.attribute('id')).version = it.attribute('version')
    }
}


allprojects {
    apply plugin: 'base'
    apply plugin: 'maven'

    uploadArchives {
        repositories {
            ivy {
                url repositoryUrl
            }
        }
    }
}

tasks.build.dependsOn ConfigParse

subprojects {
    buildDir = rootProject.buildDir
    description = 'Binary artifact ' + projectDir
    group = 'nitro'

    task zip(type: Zip) {
        from projectDir
		include '**/*.targets'
        include 'include/**/*.*'
        include '**/*.dll'
        include '**/*.dll'
        include '**/*.lib'
        include '**/*.so'
        include '**/*.a'
        exclude '*.gradle'
		exclude '*.iml'
		exclude '*.git'
		exclude '*.gitignore'
		exclude 'build/**/*.*'
		//into project.name + '.' + project.version
    }

    artifacts {
        'default' zip
    }
}

task publish {
	dependsOn build
    subprojects.each {
        dependsOn it.path + ':uploadArchives'
    }
}

dependencies {
    subprojects.each {
        'default' project(path: it.path)
    }
}

task wrapper( type: Wrapper, description: "create a gradlew" ) {
    gradleVersion = '2.8'
}

